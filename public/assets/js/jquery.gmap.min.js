!function(b){b.fn.gMap=function(a,f){switch(a){case"addMarker":return b(this).trigger("gMap.addMarker",[f.latitude,f.longitude,f.content,f.icon,f.popup]);case"centerAt":return b(this).trigger("gMap.centerAt",[f.latitude,f.longitude,f.zoom]);case"clearMarkers":return b(this).trigger("gMap.clearMarkers")}var e=b.extend({},b.fn.gMap.defaults,a);return this.each(function(){var y=new google.maps.Map(this);b(this).data("gMap.reference",y);var x=new google.maps.Geocoder;e.address?x.geocode({address:e.address},function(c){c&&c.length&&y.setCenter(c[0].geometry.location)}):e.latitude&&e.longitude?y.setCenter(new google.maps.LatLng(e.latitude,e.longitude)):b.isArray(e.markers)&&e.markers.length>0?e.markers[0].address?x.geocode({address:e.markers[0].address},function(c){c&&c.length>0&&y.setCenter(c[0].geometry.location)}):y.setCenter(new google.maps.LatLng(e.markers[0].latitude,e.markers[0].longitude)):y.setCenter(new google.maps.LatLng(34.885931,9.84375)),y.setZoom(e.zoom),y.setMapTypeId(google.maps.MapTypeId[e.maptype]);var w={scrollwheel:e.scrollwheel,disableDoubleClickZoom:!e.doubleclickzoom};e.controls===!1?b.extend(w,{disableDefaultUI:!0}):0!==e.controls.length&&b.extend(w,e.controls,{disableDefaultUI:!0}),y.setOptions(w);var v,u,t=new google.maps.Marker;v=new google.maps.MarkerImage(e.icon.image),v.size=new google.maps.Size(e.icon.iconsize[0],e.icon.iconsize[1]),v.anchor=new google.maps.Point(e.icon.iconanchor[0],e.icon.iconanchor[1]),t.setIcon(v),e.icon.shadow&&(u=new google.maps.MarkerImage(e.icon.shadow),u.size=new google.maps.Size(e.icon.shadowsize[0],e.icon.shadowsize[1]),u.anchor=new google.maps.Point(e.icon.shadowanchor[0],e.icon.shadowanchor[1]),t.setShadow(u)),b(this).bind("gMap.centerAt",function(g,j,i,h){h&&y.setZoom(h),y.panTo(new google.maps.LatLng(parseFloat(j),parseFloat(i)))});var s=[];b(this).bind("gMap.clearMarkers",function(){for(;s[0];){s.pop().setMap(null)}});var r;b(this).bind("gMap.addMarker",function(G,F,E,D,C,B){var A,z,j=new google.maps.LatLng(parseFloat(F),parseFloat(E)),i=new google.maps.Marker({position:j});if(C?(A=new google.maps.MarkerImage(C.image),A.size=new google.maps.Size(C.iconsize[0],C.iconsize[1]),A.anchor=new google.maps.Point(C.iconanchor[0],C.iconanchor[1]),i.setIcon(A),C.shadow&&(z=new google.maps.MarkerImage(C.shadow),z.size=new google.maps.Size(C.shadowsize[0],C.shadowsize[1]),z.anchor=new google.maps.Point(C.shadowanchor[0],C.shadowanchor[1]),t.setShadow(z))):(i.setIcon(t.getIcon()),i.setShadow(t.getShadow())),D){"_latlng"===D&&(D=F+", "+E);var h=new google.maps.InfoWindow({content:e.html_prepend+D+e.html_append});google.maps.event.addListener(i,"click",function(){r&&r.close(),h.open(y,i),r=h}),B&&google.maps.event.addListenerOnce(y,"tilesloaded",function(){h.open(y,i)})}i.setMap(y),s.push(i)});for(var q,p=this,o=function(c){return function(g){g&&g.length>0&&b(p).trigger("gMap.addMarker",[g[0].geometry.location.lat(),g[0].geometry.location.lng(),c.html,c.icon,c.popup])}},d=0;d<e.markers.length;d++){q=e.markers[d],q.address?("_address"===q.html&&(q.html=q.address),x.geocode({address:q.address},o(q))):b(this).trigger("gMap.addMarker",[q.latitude,q.longitude,q.html,q.icon,q.popup])}})},b.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:!1,doubleclickzoom:!0,maptype:"ROADMAP",html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}}(jQuery);